<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
"http://www.w3.org/TR/html4/strict.dtd">
<html>
  <head>
    <title>CodeGeneration</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <link rel="stylesheet" href="./static/css/blueprint/screen.css" type="text/css" media="screen, projection">
    <link rel="stylesheet" href="./static/css/blueprint/print.css" type="text/css" media="print">
    <!--[if lt IE 8]>
      <link rel="stylesheet" href="./static/css/blueprint/ie.css" type="text/css" media="screen, projection">
    <![endif]-->
    <link rel="stylesheet" href="./static/css/pygments/syntax.css" type="text/css">
    <link rel="stylesheet" href="./static/css/layout.css" type="text/css">
    <link rel="stylesheet" href="./static/css/colors.css" type="text/css">
    <script type="text/javascript" src="./static/js/graph.js"></script>
  </head>
  <body>
    <div class="container noshowgrid">
      <div class="span-20 prepend-2 append-2">
        <h1>CodeGeneration</h1>
        <div class="figure">
<img src="./static/images/stage-code-gen.png" alt="Code generation." /><p class="caption">Code generation.</p>
</div>
<p>Now it's time to generate C code from the parse tree. The generated code will use the <a href="RuntimeSupport.html" title="RuntimeSupport">RuntimeSupport</a> library.</p>
<p>Generating code in Haskell means generating a string that contains C code and then writing it to a file. In <a href="CodeGenerationFramework.html" title="CodeGenerationFramework">CodeGenerationFramework</a> we make a small framework that allows us to generate that string in a more elegant way.</p>
<p>There are two things we need to generate: first the main function <code>con_main</code>, and then one C function per con function.</p>
<p>The easiest way to get a feeling for how these two things should look like is to compile a <a href="https://github.com/rickardlindberg/compiler-tutorial/blob/master/scale.con">test program</a> using the reference implementation and then look at the generated code. If the <a href="https://github.com/rickardlindberg/compiler-tutorial/blob/master/src/compile.sh">compile</a> script is used, the generated file is located in <code>sketch/con_program.cpp</code>.</p>
<h2 id="generating-the-main-function">Generating the main function</h2>
<p>The main function should create the global environment and start calling the main function.</p>
<h2 id="generating-code-for-a-function">Generating code for a function</h2>
<p>TODO:</p>
<h2 id="continue">Continue</h2>
<p><a href="AssembleHex.html" title="AssembleHex">AssembleHex</a></p>
        <hr />
        <svg xmlns="http://www.w3.org/2000/svg" id="canvas"></svg>
        <script type="text/javascript">
            var colors = function (level) {
                if (level == 1) {
                    return {
                        color: "#fcaf3e",
                        stroke: "#ab7423"
                    };
                } else if (level == 2) {
                    return {
                        color: "#fce94f",
                        stroke: "#c4a000"
                    };
                } else if (level == 3) {
                    return {
                        color: "#8ae234",
                        stroke: "#425d26"
                    };
                }
            };
            var goToPageFn = function(page) {
                return function() {
                    location.href = page + ".html";
                };
            };
            var g = new Graph("canvas", 800, 400);
            g.repulsion = g.repulsion / 2;
            //g.spring_length = 8;
            g.createVertex("CodeGeneration", colors(1), goToPageFn("CodeGeneration"));g.createVertex("AssembleHex", colors(2), goToPageFn("AssembleHex"));g.createVertex("CodeGenerationFramework", colors(2), goToPageFn("CodeGenerationFramework"));g.createVertex("RuntimeSupport", colors(2), goToPageFn("RuntimeSupport"));g.createVertex("ExecutionModel", colors(3), goToPageFn("ExecutionModel"));g.createVertex("MovingForward", colors(3), goToPageFn("MovingForward"));
            g.createEdge("CodeGeneration", "AssembleHex");g.createEdge("CodeGeneration", "CodeGenerationFramework");g.createEdge("CodeGeneration", "RuntimeSupport");g.createEdge("AssembleHex", "CodeGeneration");g.createEdge("AssembleHex", "MovingForward");g.createEdge("AssembleHex", "RuntimeSupport");g.createEdge("CodeGenerationFramework", "CodeGeneration");g.createEdge("RuntimeSupport", "CodeGeneration");g.createEdge("RuntimeSupport", "ExecutionModel");g.createEdge("ExecutionModel", "RuntimeSupport");
            g.go();
        </script>
        <hr />
        <p>
        <center>
        1. <a href="HomePage.html">HomePage</a>
        |
        2. <a href="StageParsing.html">StageParsing</a>
        |
        3. <a href="RuntimeSupport.html">RuntimeSupport</a>
        |
        4. <a href="CodeGeneration.html">CodeGeneration</a>
        |
        5. <a href="AssembleHex.html">AssembleHex</a>
        |
        6. <a href="MovingForward.html">MovingForward</a>
        </center>
        </p>
        <hr />

        <div id="disqus_thread"></div>
        <script type="text/javascript">
        var disqus_shortname = 'compilertutorial';
        (function() {
         var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
         dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
         (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
         })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

        <hr />
      </div>
    </div>
  </body>
</html>